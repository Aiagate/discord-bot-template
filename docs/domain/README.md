# Domainå±¤ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Domainå±¤ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰ã®è¨­è¨ˆã¨å®Ÿè£…ã«é–¢ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ðŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§

### [Domainå®Ÿè£…ã‚¬ã‚¤ãƒ‰](./DOMAIN_IMPLEMENTATION_GUIDE.md)

Domainå±¤ã®å®Ÿè£…æ–¹æ³•ã‚’è©³ç´°ã«èª¬æ˜Žã—ãŸç·åˆã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

**å«ã¾ã‚Œã‚‹å†…å®¹:**

- Domainå±¤ã®å½¹å‰²ã¨è²¬å‹™
- Aggregateï¼ˆé›†ç´„ï¼‰ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆProtocolï¼‰ã®å®šç¾©æ–¹æ³•
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç®¡ç†ï¼ˆIAuditableï¼‰
- ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å›žé¿æ–¹æ³•

**å¯¾è±¡èª­è€…:**

- æ–°ã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹é–‹ç™ºè€…
- Domainå±¤ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã†é–‹ç™ºè€…
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç†è§£ã—ãŸã„é–‹ç™ºè€…

---

## ðŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### æ–°ã—ã„é›†ç´„ã‚’ä½œæˆã™ã‚‹

1. `app/domain/aggregates/` ã«æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. `@dataclass` ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©
3. `__post_init__` ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…
4. å¿…è¦ã«å¿œã˜ã¦ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 

```python
# app/domain/aggregates/product.py
from dataclasses import dataclass, field
from datetime import UTC, datetime
from decimal import Decimal


@dataclass
class Product:
    """Product aggregate root.

    Implements IAuditable for automatic timestamp management.
    """
    id: int
    name: str
    price: Decimal
    created_at: datetime = field(default_factory=lambda: datetime.now(UTC))
    updated_at: datetime = field(default_factory=lambda: datetime.now(UTC))

    def __post_init__(self) -> None:
        """Validate product data."""
        if not self.name:
            raise ValueError("Product name cannot be empty.")
        if self.price < 0:
            raise ValueError("Product price must be non-negative.")

    def update_price(self, new_price: Decimal) -> "Product":
        """Update product price with validation."""
        if new_price < 0:
            raise ValueError("Price must be non-negative.")
        self.price = new_price
        return self
```

### ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è‡ªå‹•ç®¡ç†ã™ã‚‹

ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆ`created_at`, `updated_at`ï¼‰ã‚’è‡ªå‹•ç®¡ç†ã—ãŸã„å ´åˆã¯ã€`IAuditable`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æº€ãŸã™ã‚ˆã†ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å®šç¾©ã—ã¾ã™ï¼š

```python
from dataclasses import dataclass, field
from datetime import UTC, datetime


@dataclass
class MyEntity:
    """Implements IAuditable for automatic timestamp management."""
    id: int
    name: str
    # ã“ã®2ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§IAuditableã‚’æº€ãŸã™
    created_at: datetime = field(default_factory=lambda: datetime.now(UTC))
    updated_at: datetime = field(default_factory=lambda: datetime.now(UTC))
```

ãƒªãƒã‚¸ãƒˆãƒªå±¤ãŒè‡ªå‹•çš„ã«`updated_at`ã‚’æ›´æ–°ã—ã¾ã™ã€‚

---

## ðŸ“– é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](../ARCHITECTURE.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- [èª²é¡Œãƒ»æ”¹å–„ç‚¹ãƒªã‚¹ãƒˆ](../ISSUES_AND_IMPROVEMENTS.md) - æŠ€è¡“çš„ãªèª²é¡Œã¨æ”¹å–„ææ¡ˆ

---

## ðŸ’¡ ãƒ’ãƒ³ãƒˆ

### è‰¯ã„ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ç‰¹å¾´

- **ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒæ˜Žç¢º**: ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚ã°ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒã‚ã‹ã‚‹
- **ä¸å¤‰æ¡ä»¶ã‚’ä¿è¨¼**: å¸¸ã«æœ‰åŠ¹ãªçŠ¶æ…‹ã‚’ä¿ã¤
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯éžä¾å­˜**: ç´”ç²‹ãªPythonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- **ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„**: å¤–éƒ¨ä¾å­˜ãªã—ã§ãƒ†ã‚¹ãƒˆå¯èƒ½

### ã‚ˆãã‚ã‚‹è³ªå•

**Q: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®é•ã„ã¯ï¼Ÿ**

A:

- **ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰**: å˜ä¸€ã®é›†ç´„å†…ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹: `change_email`ï¼‰
- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: è¤‡æ•°ã®é›†ç´„ã‚„ãƒªãƒã‚¸ãƒˆãƒªã‚’å”èª¿ã•ã›ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ•ãƒ­ãƒ¼ï¼ˆä¾‹: `CreateUserHandler`ï¼‰

**Q: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã©ã¡ã‚‰ã§è¡Œã†ã¹ãï¼Ÿ**

A:

- **ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤**: ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¸å¤‰æ¡ä»¶ï¼ˆä¾‹: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ï¼‰
- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¾‹: é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼‰

**Q: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è²¬å‹™ï¼Ÿ**

A: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯ç›£æŸ»ï¼ˆAuditï¼‰ã®ãŸã‚ã®ã‚¤ãƒ³ãƒ•ãƒ©ã®é–¢å¿ƒäº‹ã§ã™ãŒã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å«ã‚ã‚‹ã“ã¨ã§ã€ç›£æŸ»æƒ…å ±ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚`IAuditable`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã‚Šã€ã“ã®é–¢å¿ƒäº‹ã‚’æ˜Žç¤ºçš„ã«åˆ†é›¢ã—ã¦ã„ã¾ã™ã€‚

---

## ðŸ¤ è²¢çŒ®

Domainå±¤ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ”¹å–„ã™ã‚‹ææ¡ˆãŒã‚ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§è²¢çŒ®ã—ã¦ãã ã•ã„ï¼š

1. æ–°ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…
2. ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
3. ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°
4. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

---

æœ€çµ‚æ›´æ–°æ—¥: 2025-11-26
